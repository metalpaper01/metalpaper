

pdf(file='./metal_bands.100chains_RTT_plots.pdf',width=12, height=8)
par(mfrow=c(2,4))
library(scales)
###metal_bands.100chains_mcmc###

#Number Shifts
unique=c(4.0, 5.0,6.0,7.0,8.0,9.0,10.0,11.0)
counts=c(1, 206,25600,35606,9450,1054,80,3)
plot(unique,counts,type = 'h', xlim = c(0,12.0), ylab = 'Frequency', xlab = 'n. shifts',lwd=5,col='#4c4cec')
#Birth rate Plot
time=c(1968.5, 1969.5,1970.5,1971.5,1972.5,1973.5,1974.5,1975.5,1976.5,1977.5,1978.5,1979.5,1980.5,1981.5,1982.5,1983.5,1984.5,1985.5,1986.5,1987.5,1988.5,1989.5,1990.5,1991.5,1992.5,1993.5,1994.5,1995.5,1996.5,1997.5,1998.5,1999.5)
birth_rate=c(0.30853702629373797, 0.30584419871864715,0.30300352199930164,0.29666648543486074,0.2918226624067539,0.2851256430100744,0.28456023943550257,0.2846764956847529,0.28619190173119696,0.3009268753172439,0.33708481616180275,0.4604179323677173,0.4943383118925258,0.4962637810918498,0.49627904500642683,0.4962354871531623,0.4876268578848858,0.4091659004814544,0.4064247923207305,0.40641187036131404,0.3331382034520904,0.3312037056086159,0.3300946420116783,0.32930815877588454,0.32924111553662927,0.32627303898238746,0.2764849843675198,0.273922016980619,0.2600140915656821,0.22967185094501388,0.22646982907856986,0.22637829462959724)
birth_minHPD=c(0.174133565891, 0.182292477543,0.176833322303,0.177021201233,0.185492264039,0.190016812599,0.188993156131,0.189950929314,0.189236627906,0.206211769458,0.221086634573,0.290769457897,0.461900898081,0.464196555275,0.464754606311,0.464972965141,0.412192713123,0.384552304259,0.387903087045,0.387980258519,0.320536368176,0.320911345949,0.320654312389,0.320228317128,0.320220719063,0.299394682759,0.26301728223,0.261441019519,0.238985449093,0.221312155496,0.220059922202,0.219842364653)
birth_maxHPD=c(0.500324945277, 0.487510991782,0.462848468613,0.414322439718,0.394877964855,0.381661066793,0.378912562066,0.379722349101,0.383125310955,0.494473473511,0.511236550782,0.529446710089,0.530462076917,0.527185476228,0.527575803403,0.527654552925,0.521545150574,0.430723245149,0.425196769918,0.425306093984,0.352714618953,0.345064369283,0.339998085874,0.338132365961,0.338159581522,0.338127137774,0.295976362459,0.287392058814,0.276884512537,0.246585134011,0.232949488518,0.232673505378)
plot(time,time,type = 'n', ylim = c(0, 0.5835082846087001), xlim = c(1968.0,2000.5), ylab = 'Birth rate', xlab = 'Time (AD)',main='metal_bands.100chains_mcmc' )
polygon(c(time, rev(time)), c(birth_maxHPD, rev(birth_minHPD)), col = alpha('#4c4cec',0.3), border = NA)
lines(time,birth_rate, col = '#4c4cec', lwd=2)
#Frequency of shifts
birth_counts=c(0.0, 0.018097222222222223,0.017222222222222222,0.026111111111111113,0.02459722222222222,0.034027777777777775,0.009527777777777777,0.008861111111111111,0.013194444444444444,0.06726388888888889,0.16193055555555555,0.5723611111111111,0.19359722222222223,0.017277777777777777,0.0016111111111111111,0.0018194444444444445,0.08979166666666667,0.8803333333333333,0.03905555555555556,0.0007638888888888889,0.9727083333333333,0.03776388888888889,0.04579166666666667,0.03731944444444445,0.0044444444444444444,0.08608333333333333,0.9317083333333334,0.08001388888888888,0.44940277777777776,0.8183333333333334,0.15594444444444444,0.00575)
plot(time,birth_counts,type = 'h', xlim = c(1968.0,2000.5), ylim=c(0,0.9727083333333333), ylab = 'Frequency of rate shift', xlab = 'Time (AD)',lwd=5,col='#4c4cec')
bf2 = 0.07263562292583615
bf6 = 0.3665860015488416
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)
birth_BF2=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,0.33708481616180275,NA,0.4943383118925258,NA,NA,NA,0.4876268578848858,NA,NA,NA,NA,NA,NA,NA,NA,0.32627303898238746,NA,0.273922016980619,NA,NA,0.22646982907856986,NA)
birth_BF6=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.4604179323677173,NA,NA,NA,NA,NA,0.4091659004814544,NA,NA,0.3331382034520904,NA,NA,NA,NA,NA,0.2764849843675198,NA,0.2600140915656821,0.22967185094501388,NA,NA)
#Net Rate
net_rate=c(0.27353793704750073, 0.27285182468828595,0.2713530563068717,0.2656503638501646,0.2610692467776474,0.25456855597671746,0.2541089563007413,0.2541983803650613,0.25558874979869006,0.26999786733225445,0.30513354402190096,0.40156644613405007,0.4068867949736567,0.35895730033279755,0.3501323464635128,0.3481494751133973,0.2985691598733647,0.2128913061914933,0.21013361063721014,0.2101243210193217,0.13684916423210086,0.13489898015225657,0.13378708964632188,0.13300018164115257,0.13266814199149743,0.13125789535601415,0.08769871487135464,0.09179815384245975,0.08796678094483985,0.08727212015726839,0.0933244607190773,0.09355487913597652)
net_minHPD=c(0.1142722902384, 0.1351523311317,0.1393353029096,0.13911329090219998,0.1488787652858,0.1536523256049,0.15419684892580002,0.15419684892580002,0.15162585740200002,0.1653794702047,0.1831195423004,0.2280301640226,0.328505420283,0.310332769761,0.30110509602700003,0.29612151914999996,0.21585628561999998,0.186100147304,0.190579169523,0.190562272533,0.12163078593399998,0.12210888121299998,0.122632988764,0.12260564886,0.12174743774100003,0.10210692236799998,0.067492536096,0.07161150266900002,0.06081103990100001,0.064197343948,0.084075347134,0.084422108059)
net_maxHPD=c(0.49187746104240004, 0.4675052857072,0.4389777728964,0.38760819060651,0.3693827338836,0.35480496486130003,0.35321180186499995,0.3532022845287,0.35480496486130003,0.4624444034497,0.48891414671965,0.5022851684424,0.48195212125289993,0.41686178003759994,0.39498056076800003,0.3939854509299999,0.351455645162,0.23458600095799997,0.22976538886500003,0.229757580803,0.157302760207,0.14915649343,0.14495989627699998,0.14341574613100003,0.14354826391899997,0.15077507195300002,0.11051182313000002,0.11107006882599998,0.117709441492,0.11006741555900001,0.10301634181899999,0.103129614866)
plot(time,time,type = 'n', ylim = c(0, 0.55251368528664), xlim = c(1968.0,2000.5), ylab = 'Net Rate', xlab = 'Time (AD)',lwd=2, main='', col= '#32CD32' )
polygon(c(time, rev(time)), c(net_maxHPD, rev(net_minHPD)), col = alpha('#32CD32',0.3), border = NA)
lines(time,net_rate, col = '#32CD32', lwd=2)
abline(h=0,lty=2)

#Number Shifts
unique=c(3.0, 4.0,5.0,6.0,7.0,8.0,9.0)
counts=c(50, 646,38562,26588,5676,455,23)
plot(unique,counts,type = 'h', xlim = c(0,12.0), ylab = 'Frequency', xlab = 'n. shifts',lwd=5,col='#e34a33')
#Death rate Plot
time=c(1968.5, 1969.5,1970.5,1971.5,1972.5,1973.5,1974.5,1975.5,1976.5,1977.5,1978.5,1979.5,1980.5,1981.5,1982.5,1983.5,1984.5,1985.5,1986.5,1987.5,1988.5,1989.5,1990.5,1991.5,1992.5,1993.5,1994.5,1995.5,1996.5,1997.5,1998.5,1999.5)
death_rate=c(0.03499908924623458, 0.032992374030358484,0.03165046569242693,0.031016121584695043,0.030753415629106294,0.03055708703336005,0.030451283134763585,0.03047811531969416,0.030603151932509554,0.030929007984986597,0.03195127213989662,0.05885148623366442,0.08745151691887129,0.13730648075905225,0.14614669854291384,0.1480860120397644,0.18905769801152586,0.19627459428995725,0.19629118168351598,0.1962875493419877,0.1962890392199926,0.19630472545636174,0.1963075523653588,0.196307977134735,0.19657297354513573,0.19501514362637634,0.18878626949616334,0.18212386313815485,0.172047310620836,0.1423997307877426,0.13314536835948848,0.13282341549361676)
death_minHPD=c(0.00212526782883, 0.00295463470813,0.00312117243898,0.00363073779485,0.003545990856,0.00354231067692,0.00365603074076,0.00363073779485,0.00365603074076,0.00366265326582,0.004009939462,0.0140843250642,0.0268598773188,0.0820992437671,0.120469045957,0.121863324146,0.151920842298,0.190253794688,0.190317761151,0.190382746615,0.190385253941,0.190403779972,0.190398226665,0.190386003227,0.19020671176,0.181944599768,0.175202742752,0.170720421623,0.153046862052,0.13071777283,0.125730880637,0.125786942351)
death_maxHPD=c(0.0670608540235, 0.0621091420522,0.059529588141,0.0586208089687,0.0578126520414,0.0572381211585,0.0570178811957,0.0569681705708,0.0572381211585,0.0579574552119,0.0607883177167,0.138348801358,0.15193397896,0.169976292002,0.195316202484,0.196695417691,0.2035221065,0.20228125274,0.202264883473,0.202292759879,0.202286019067,0.202292438134,0.202286019067,0.202284779846,0.202657863808,0.202368583554,0.199641216353,0.19686274507,0.184665074478,0.160459950979,0.139422957581,0.139104437701)
plot(time,time,type = 'n', ylim = c(0, 0.22387431715), xlim = c(1968.0,2000.5), ylab = 'Death rate', xlab = 'Time (AD)',main='' )
polygon(c(time, rev(time)), c(death_maxHPD, rev(death_minHPD)), col = alpha('#e34a33',0.3), border = NA)
lines(time,death_rate, col = '#e34a33', lwd=2)
#Frequency of shifts
death_counts=c(0.0, 0.020722222222222222,0.01561111111111111,0.011930555555555555,0.008583333333333333,0.008055555555555555,0.007430555555555556,0.006694444444444445,0.0076527777777777774,0.011333333333333334,0.022152777777777778,0.3148888888888889,0.28002777777777776,0.5070972222222222,0.12134722222222222,0.033527777777777774,0.7334305555555556,0.18729166666666666,0.0019861111111111112,0.0013333333333333333,0.0009305555555555556,0.00175,0.0011805555555555556,0.0009583333333333333,0.012263888888888888,0.08483333333333333,0.3309722222222222,0.3198888888888889,0.3044027777777778,0.7557916666666666,0.39993055555555557,0.022819444444444444)
plot(time,death_counts,type = 'h', xlim = c(1968.0,2000.5), ylim=c(0,0.7557916666666666), ylab = 'Frequency of rate shift', xlab = 'Time (AD)',lwd=5,col='#e34a33')
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)
death_BF2=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.05885148623366442,0.08745151691887129,NA,0.14614669854291384,NA,NA,0.19627459428995725,NA,NA,NA,NA,NA,NA,NA,0.19501514362637634,0.18878626949616334,0.18212386313815485,0.172047310620836,NA,NA,NA)
death_BF6=c(NA, NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.13730648075905225,NA,NA,0.18905769801152586,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.1423997307877426,0.13314536835948848,NA)
#Net Diversity
net_diversity=c(1.0, 2.0,5.0,8.0,13.0,13.5,16.0,20.0,25.0,35.5,52.0,85.0,145.0,264.0,456.0,767.5,1141.5,1540.5,1949.0,2521.0,3071.5,3657.5,4304.0,5029.5,5859.5,6658.0,7448.0,8263.5,9038.0,9869.0,10924.0,12088.5)
plot(time,net_diversity,type = 'l', ylab = 'Net Diversity', xlab = 'Time (AD)',lwd=2, main='', col= '#32CD32' )


#PRETTY PLOT
library(ggplot2)

emp_birth=c(NA, 0.5,0.6,0.375,0.38461538461538464,0.07407407407407407,0.1875,0.2,0.2,0.30985915492957744,0.3269230769230769,0.4117647058823529,0.4689655172413793,0.5340909090909091,0.5263157894736842,0.5172638436482084,0.463425317564608,0.4251866277182733,0.39148281169830684,0.40222134073780247,0.35650333713169463,0.34313055365686945,0.3336431226765799,0.32229843920866885,0.3321102483147026,0.3127065184740162,0.2863856068743287,0.2749440309796091,0.25392786014605,0.2356875063329618,0.22766385939216405,0.21929933407784258)
emp_death=c(NA, 0.0,0.0,0.0,0.0,0.07407407407407407,0.0,0.0,0.0,0.028169014084507043,0.0,0.047058823529411764,0.08275862068965517,0.12121212121212122,0.14035087719298245,0.13941368078175895,0.17783618046430136,0.2005842259006816,0.20523345305284763,0.19198730662435542,0.19697216343805957,0.20041011619958987,0.19656133828996283,0.18789144050104384,0.21964331427596212,0.19224992490237308,0.18877551020408162,0.18236824590064743,0.1697278158884709,0.1475326780828858,0.12889051629439766,0.12946188526285313)
rates.dat=data.frame(time,emp_birth,emp_death,birth_rate,birth_minHPD,birth_maxHPD,birth_BF2,birth_BF6,death_minHPD,death_maxHPD,death_BF2,death_BF6)
ggplot(rates.dat, aes(time,birth_rate)) +
    geom_line(size=.7,col='blue') +
    geom_line(aes(time,death_rate),col='red',size=.7) +
     scale_color_manual(values = c('blue','red')) +
    scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
    scale_y_continuous(breaks=seq(0.0,0.6000000000000001,.1),limits = c(0.0,0.6000000000000001)) + 
    geom_ribbon(aes_string(ymin=birth_minHPD,ymax=birth_maxHPD,fill=shQuote('red')),alpha=.2,col=NA)+ 
    geom_ribbon(aes_string(ymin=death_minHPD,ymax=death_maxHPD,fill=shQuote('blue')),alpha=.2,col=NA)+
    geom_line(aes(time,emp_birth,col='eb'),size=.5,linetype = 'dashed')+
    geom_line(aes(time,emp_death,col='ed'),size=.5,linetype = 'dashed')+
    geom_point(aes(time,birth_BF2), size = 4, alpha=1,col='yellow') +
    geom_point(aes(time,birth_BF6), size = 8, alpha=1,col='yellow') +
    geom_point(aes(time,death_BF2), size = 4, alpha=1,col='yellow') +
    geom_point(aes(time,death_BF6), size = 8, alpha=1,col='yellow') +
    theme(legend.position = 'none')+
    labs(x='Time',y='Rates')




n <- dev.off()