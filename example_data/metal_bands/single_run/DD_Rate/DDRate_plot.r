usePackage <- function(p){
if (!is.element(p, installed.packages()[,1]))
install.packages(p, dep = TRUE)
require(p, character.only = TRUE)}
usePackage('ggplot2')
usePackage('gridExtra')

time=c(1968.5, 1969.5,1970.5,1971.5,1972.5,1973.5,1974.5,1975.5,1976.5,1977.5,1978.5,1979.5,1980.5,1981.5,1982.5,1983.5,1984.5,1985.5,1986.5,1987.5,1988.5,1989.5,1990.5,1991.5,1992.5,1993.5,1994.5,1995.5,1996.5,1997.5,1998.5,1999.5)
net_diversity=c(1.0, 2.0,5.0,8.0,13.0,14.0,16.5,20.0,25.0,36.0,52.5,84.5,145.0,266.5,455.5,758.5,1130.0,1525.5,1937.0,2517.0,3081.5,3688.0,4345.5,5063.0,5889.5,6689.5,7471.5,8269.5,9044.0,9883.5,10914.0,12074.5)
emp_birth=c(NA, 0.5,0.6,0.375,0.38461538461538464,0.07142857142857142,0.18181818181818182,0.2,0.2,0.3055555555555556,0.3238095238095238,0.41420118343195267,0.4689655172413793,0.5290806754221389,0.5268935236004391,0.5234014502307185,0.46814159292035395,0.429367420517863,0.3939081053175013,0.4028605482717521,0.355346422196982,0.34029284164859,0.330456794384996,0.32016590953979857,0.33041854147211136,0.31123402346961654,0.28548484240112426,0.27474454320091907,0.25375939849624063,0.23534173116810847,0.2278724573941726,0.21955360470412855)
emp_death=c(NA, 0.0,0.0,0.0,0.0,0.0,0.06060606060606061,0.0,0.0,0.0,0.01904761904761905,0.05917159763313609,0.06896551724137931,0.10881801125703565,0.1602634467618002,0.15161502966381016,0.17699115044247787,0.20911176663389053,0.1982447083118224,0.19229241160111243,0.18724647087457408,0.19522776572668113,0.19261304798066967,0.19158601619593127,0.2154682061295526,0.19358696464608716,0.18831559927725355,0.1863474212467501,0.16585581601061478,0.14903627257550464,0.1319406267179769,0.1276243322704874)
birth_rate=c(0.534996263814657, 0.483607368390156,0.405395777245168,0.36005081900592856,0.309214731072132,0.301597297099751,0.281503519060312,0.2629029298850608,0.256652847922396,0.267842219007304,0.330578414516668,0.425436690589976,0.502563151223352,0.529365325305817,0.520785932747127,0.491882603692923,0.4625689332702231,0.437725690409647,0.417039411240378,0.392860740326955,0.37312120902370804,0.355719235722543,0.33933381302210897,0.323030090243286,0.30628343334999497,0.291680631712878,0.278671935987831,0.26668726109255203,0.256012139200104,0.24502334347915602,0.23266069476291898,0.22020390480496002)
birth_minHPD=c(0.46835355327699996, 0.40719388952299995,0.307654670471,0.255167561845,0.19226057812,0.18624480549699998,0.162243762147,0.147764593656,0.159624564021,0.18384241343899999,0.222416532751,0.32699272890299996,0.43019256536899997,0.485796442206,0.49452457308700004,0.465936565528,0.447418680822,0.42455760383,0.406880064976,0.385161398029,0.366995048957,0.34968115520099996,0.333333235081,0.31759611574499996,0.30180289789500003,0.287629678629,0.274609688893,0.26265255119500003,0.252008275347,0.241502103871,0.22833864321,0.215342029585)
birth_maxHPD=c(0.624908297887, 0.570651413281,0.500127556516,0.46359389054399996,0.42137678064,0.414670950917,0.392411173909,0.369135368662,0.349100257962,0.368236224368,0.440767103018,0.5392039061899999,0.569951761179,0.570580932615,0.5529107923100001,0.511160691929,0.481418410453,0.450679641149,0.427621117525,0.4015921307,0.381168935984,0.362280874621,0.34489213332199997,0.328163337103,0.311347553364,0.296283327586,0.282596514387,0.270023506642,0.25923849320799996,0.249000623692,0.237010199628,0.226099903037)
death_rate=c(0.16892237194657703, 0.16894593692299298,0.169015721347633,0.169097847500699,0.169320036041989,0.169363545194439,0.16950862986302698,0.16959748609403702,0.169456905730305,0.16924588886336,0.168985224695501,0.168906422200546,0.16890001580704497,0.168900316850552,0.168902147326126,0.168905583682946,0.168909847734517,0.16891445135276598,0.168919267359546,0.168926551740268,0.16893451553103803,0.168943893452324,0.168955852338121,0.16897242112028202,0.168997051035605,0.169028313376584,0.169067758838241,0.16911809342158401,0.169178685005245,0.169262266394147,0.169391599148241,0.16957453445074)
death_minHPD=c(0.16633130765, 0.166331307917,0.166331318463,0.16630634687100002,0.166248785155,0.166155945311,0.166543229673,0.16632689349000002,0.166338845338,0.166722117403,0.166286438639,0.166278751864,0.16633130765100002,0.166331307832,0.166331309312,0.166331320673,0.166331371949,0.166331521514,0.166331852698,0.166332846039,0.166334769117,0.166347266896,0.166344275386,0.16635350571799998,0.166370549179,0.16640481476299998,0.166430804657,0.166474193697,0.166656368065,0.166722694713,0.166813514306,0.166952142072)
death_maxHPD=c(0.171533229133, 0.171533229154,0.17153323028499998,0.17153323793699998,0.17156458224100002,0.171620016673,0.172263367696,0.17240968083799998,0.17219899397500002,0.172264405609,0.171485072779,0.171481764114,0.17153322914900002,0.171533229146,0.17153322925,0.17153323022199998,0.171533235334,0.171533252104,0.171533292804,0.17153342638500002,0.17153370647900001,0.171534242029,0.17153524254900002,0.171538260031,0.171549541698,0.171568530234,0.17158551367,0.17165627732500002,0.171833174954,0.171910637364,0.172017351803,0.172175883545)
niche=c(155.10106296149678, 155.10580367246675,155.11959502397954,155.16115524983948,155.29163617407502,155.72108896054712,157.21287838349,162.7242974118123,184.60556399418903,279.76171727027264,768.0857187409571,3852.321654313945,15255.318515854608,34005.69128602999,48230.5610959809,54108.18558754081,55915.748810607896,56427.3336145354,56572.464448107195,56614.89728426589,56627.7769235708,56631.835314632306,56633.159356311895,56633.6050345625,56633.7592502652,56633.8139164762,56633.833705752295,56633.8410013514,56633.8437339354,56633.8447716457,56633.8451705014,56633.845325434195)
niche_minHPD=c(29.6091840986, 29.6110256608,29.6183440876,29.647427730500002,29.763006705,30.2223154816,42.228035894,50.234201138900005,61.239916866899996,107.60558163200001,185.81150662299999,500.97797951900003,4200.59737449,14511.346260799997,28617.2934749,37670.6465417,38692.1356417,39953.5088535,39940.036847,39851.5769969,39853.398421499995,39853.77904180001,39853.858576,39853.8751953,39853.878668,39853.8793936,39853.8795452,39853.8795769,39853.8795835,39853.8795849,39853.8795852,39853.879585300005)
niche_maxHPD=c(352.409337995, 352.410439638,352.415162753,352.43541232300004,352.522228894,352.894438383,361.40853799,361.408538421,371.66367509599996,550.880668186,1636.35934707,8902.48540028,40309.013469800004,53452.3269823,65716.451842,73099.7909408,76458.69936469999,78631.0049719,78756.2260175,78843.4372513,78866.78633660001,78873.0311555,78874.7009003,78875.1473252,78875.2666795,78875.29858939999,78875.3071206,78875.3094015,78875.3100113,78875.3101743,78875.31021789998,78875.3102295)

rates.dat<-data.frame(time,net_diversity,emp_birth,emp_death,birth_rate,birth_minHPD,birth_maxHPD,death_rate,death_minHPD,death_maxHPD,niche,niche_minHPD,niche_maxHPD)

rate_plot<-ggplot(rates.dat, aes(time,birth_rate)) +
    geom_line(size=.7,col='blue') +
    geom_line(aes(time,death_rate),col='red',size=.7) +
     scale_color_manual(values = c('blue','red')) +
    scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
    scale_y_continuous(breaks=seq(0.0,0.6000000000000001,.1),limits = c(0.0,0.6000000000000001)) + 
    geom_ribbon(aes_string(ymin=birth_minHPD,ymax=birth_maxHPD,fill=shQuote('red')),alpha=.2,col=NA)+ 
    geom_ribbon(aes_string(ymin=death_minHPD,ymax=death_maxHPD,fill=shQuote('blue')),alpha=.2,col=NA)+
    geom_line(aes(time,emp_birth,col='eb'),size=.5,linetype = 'dashed')+
    geom_line(aes(time,emp_death,col='ed'),size=.5,linetype = 'dashed')+
    theme(legend.position = 'none')+
    labs(x='Time',y='Rates')


div_plot<-ggplot(rates.dat,aes(time,net_diversity))+
      geom_line(aes(time,net_diversity,col='Net Diversity'),col='dark green',size=.5,linetype = 'dashed')+
      geom_line(aes(time,niche,col='Carrying Capacity'),size=.5) +
    scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
      geom_ribbon(aes(ymin=niche_minHPD,ymax=niche_maxHPD,fill='Carrying Capacity'),alpha=.30,col=NA) +
      theme(legend.position = 'none')+
      labs(x='Time',y='Number of Lineages')
fig<-grid.arrange(rate_plot,div_plot,nrow = 2,ncol=1)
ggsave(file='./example_data/metal_bands/single_run/DD_Rate//DDRate_plot.pdf', plot=fig)
